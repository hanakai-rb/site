<%= content_for :title, "#{page.title} &middot; #{doc.title} #{version}" %>

<%= content_for :meta do %>
  <meta
    name="docsearch:version"
    content="<%= [version_number, ("latest" if version == latest_version)].compact.join(",") %>"
  >
<% end %>

<%= render_with_slots "doc_pages/main" do |main| %>
  <% # Navigation %>
  <%= main.slot :navigation do %>
    <%= render_with_slots "doc_pages/navigation_desktop", org:, version:, other_versions:, path_prefix: "/#{doc.url_path}" do |navigation_desktop| %>
      <%= navigation_desktop.slot :nav do %>
        <ol>
          <%= render "doc_pages/pages_nav", pages: doc.pages.nested, depth: 0, testid: 'pages-nav', current_page_url: page.url_path %>
        </ol>
      <% end %>
    <% end %>
  <% end %>

  <% # Table of contents %>
  <%= main.slot :toc do %>
    <% if page.nested_headings.length > 0 %>
      <div class="absolute top-8 bottom-0 right-full w-9 overflow-hidden">
        <div
          class="
            toc-indicator lg:block top-0 absolute right-[calc(100%)+var(--spacing)*4)]
            hidden transition-transform duration-500
            ease-in-out scale-0
          "
        >
          <%= render "svgs/#{org}_logo", width: 20, height: 20 %>
        </div>
      </div>
      <div
        id="toc-scrolling-panel"
        class="
          flex-1 overflow-y-auto over scrolling-panel
          scrolling-panel--with-bottom-overlay
        "
      >
        <div class="sticky top-0">
          <div class="bg-white flex gap-2">
            <h2
              class="
                font-mono text-xs font-semibold tracking-wider uppercase
                text-primary pt-1 mb-3
              "
            >
              On this page
            </h2>
          </div>
          <div
            class="
              bg-gradient-to-b from-white to-transparent h-2
              pointer-events-none
            "
          ></div>
        </div>

        <nav
          data-defo-toc-scroll="<%= { anchorContainerSelector: ".content", "scrollReferenceSelector": "#toc-scrolling-panel", breakpoints: ["lg"] }.to_json %>"
        >
          <%= render "doc_pages/headings_toc", headings: page.nested_headings, testid: "headings-toc", depth: 0 %>
        </nav>
      </div>
    <% end %>
  <% end %>

  <% # Content %>
  <%= main.slot :content do %>
    <%= render "doc_pages/breadcrumbs", breadcrumbs: breadcrumbs %>

    <header>
      <h1 class="text-4xl font-black mb-4"><%= page.title %></h1>
    </header>

    <div class="content search-content"><%= page.content_html %></div>
  <% end %>
<% end %>
